<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.j301.mapper.IngredientMapper">

	<resultMap type="com.ssafy.j301.ingredientAvg.IngredientAvg"
		id="IngredientAvg">
		<result column="ingredient_id" property="ingredientId" />
		<result column="ingredient_avg_date"
			property="ingredientAvgDate" />
		<result column="ingredient_avg_price"
			property="ingredientAvgPrice" />
		<result column="ingredient_avg_predict_price"
			property="ingredientAvgPredictPrice" />
	</resultMap>

	<resultMap type="com.ssafy.j301.ingredient.Ingredient"
		id="Ingredient">
		<result column="ingredient_id" property="ingredientId" />
		<result column="ingredient_name" property="ingredientName" />
		<result column="ingredient_name_code"
			property="ingredientNameCode" />
		<result column="ingredient_detail_name_code"
			property="ingredientDetailNameCode" />
		<result column="ingredient_category"
			property="ingredientCategory" />
		<collection property="ingredientAvg"
			resultMap="IngredientAvg" />
	</resultMap>

	<select id="selectAll" resultMap="Ingredient">

		SELECT

		ingredient.ingredient_id,
		ingredient.ingredient_name,
		ingredient.ingredient_category,
		ingredient_avg.ingredient_avg_id,
		ingredient_avg.ingredient_avg_price,
		ingredient_avg.ingredient_avg_date,
		ingredient_avg.ingredient_avg_predict_price,
		count(watch.ingredient_id) AS 'watch'

		FROM ingredient, ingredient_avg, watch

		WHERE ingredient.ingredient_id = ingredient_avg.ingredient_id AND
		watch.ingredient_id = ingredient.ingredient_id AND
		ingredient_avg.ingredient_avg_date = "2019-01-01" AND
		watch.watch_date = "2019-01-01"

		GROUP BY watch.ingredient_id

		ORDER BY count(watch.ingredient_id) DESC;

	</select>

	<select id="selectAllByLogin" resultMap="Ingredient">

		SELECT

		ingredient.ingredient_id,
		ingredient.ingredient_name,
		ingredient.ingredient_name_code,
		ingredient.ingredient_detail_name,
		ingredient.ingredient_detail_name_code,
		ingredient.ingredient_category,
		ingredient_avg.ingredient_id,
		ingredient_avg.ingredient_avg_id,
		ingredient_avg.ingredient_avg_price,
		ingredient_avg.ingredient_avg_date,
		ingredient_avg.ingredient_avg_predict_price,
		count(watch.watch_date)

		FROM ingredient, ingredient_avg, watch

		WHERE ingredient.ingredient_id =
		ingredient_avg.ingredient_id AND
		watch.ingredient_id =
		ingredient.ingredient_id AND
		ingredient_avg.ingredient_avg_date =
		DATE_FORMAT(NOW(), "%y-%c-%e")
		AND
		watch.watch_date = DATE_FORMAT(NOW(),
		"%y-%c-%e")

		GROUP BY watch.watch_date

		ORDER BY count(watch.watch_date);

	</select>

	<select id="selectByIngredientId" resultMap="Ingredient">

		SELECT

		ingredient.ingredient_id,
		ingredient.ingredient_name,
		ingredient.ingredient_name_code,
		ingredient.ingredient_detail_name,
		ingredient.ingredient_detail_name_code,
		ingredient.ingredient_category,
		ingredient_avg.ingredient_id,
		ingredient_avg.ingredient_avg_id,
		ingredient_avg.ingredient_avg_price,
		ingredient_avg.ingredient_avg_date,
		ingredient_avg.ingredient_avg_predict_price

		FROM ingredient

		LEFT JOIN
		ingredient_avg ON ingredient.ingredient_id =
		ingredient_avg.ingredient_id

		WHERE ingredient.ingredient_id =
		#{ingredientId} AND ingredient_avg.ingredient_avg_date =
		DATE_FORMAT(NOW(), "%y-%c-%e")

	</select>

	<select id="selectByIngredientName" resultMap="Ingredient">

		SELECT

		ingredient.ingredient_id,
		ingredient.ingredient_name,
		ingredient.ingredient_name_code,
		ingredient.ingredient_detail_name,
		ingredient.ingredient_detail_name_code,
		ingredient.ingredient_category,
		ingredient_avg.ingredient_id,
		ingredient_avg.ingredient_avg_id,
		ingredient_avg.ingredient_avg_price,
		ingredient_avg.ingredient_avg_date,
		ingredient_avg.ingredient_avg_predict_price

		FROM ingredient

		LEFT JOIN
		ingredient_avg ON ingredient.ingredient_id =
		ingredient_avg.ingredient_id

		WHERE ingredient.ingredient_name =
		#{ingredientName} AND ingredient_avg.ingredient_avg_date =
		DATE_FORMAT(NOW(), "%y-%c-%e")

	</select>
</mapper>